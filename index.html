<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Midterm Examination</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap"
    rel="stylesheet">
  <link href="quiz.css" rel="stylesheet" />
</head>

<body>
  <div class="container" id="entry">
    <div class="login-card">
      <h1>Student Name</h1>
      <input type="text" id="student_name" placeholder="Chua, Joseph" />
      <button id="startQuizBtn">Start Quiz</button>
    </div>
  </div>

  <div id="quiz"></div>

  <script src="helloworld.js"></script>
  <script>
    const startQuizBtn = document.getElementById("startQuizBtn");
    const studentNameInput = document.getElementById("student_name");

    if(!localStorage.getItem('quizDone')) {
      function _0xcd6f(_0x97e56,_0x456241){var _0x2c7321=_0x22cd();return _0xcd6f=function(_0x14812d,_0x2e9119){_0x14812d=_0x14812d-(0x118b+-0x26a2+-0xb*-0x1fb);var _0x414cce=_0x2c7321[_0x14812d];return _0x414cce;},_0xcd6f(_0x97e56,_0x456241);}var _0x3d29a8=_0xcd6f;function _0x22cd(){var _0x1be825=['Warning:\x20Unfocusing\x20this\x20window\x20will\x20auto-submit\x20your\x20quiz.\x20You\x20have\x20been\x20warned!','201652vYyxEU','5846934JiDpWd','6707071ypFdcA','1437020QzTayp','25861600flyIjQ','3233644fLhHVa','93CqpHCU','blur','hmvEv','6600885VUOoAG'];_0x22cd=function(){return _0x1be825;};return _0x22cd();}(function(_0x416d38,_0x57fe59){var _0x1ba3dd=_0xcd6f,_0x2565ae=_0x416d38();while(!![]){try{var _0x3b56d1=parseInt(_0x1ba3dd(0xb3))/(0x2120+-0x5ab*0x5+-0x4c8)+-parseInt(_0x1ba3dd(0xb5))/(0xe*0x7f+-0x2*0x1f7+0xe*-0x37)+parseInt(_0x1ba3dd(0xb6))/(-0x1482+0x2*0x48+0x13f5)*(-parseInt(_0x1ba3dd(0xbb))/(0x14*0x49+0x3b*0x37+0x61f*-0x3))+parseInt(_0x1ba3dd(0xb9))/(-0xf47+0x5ed+0x95f*0x1)+-parseInt(_0x1ba3dd(0xbc))/(-0x1594+0x4f*-0x6d+0x373d)+-parseInt(_0x1ba3dd(0xb2))/(0x1623+-0x1*0x311+-0x177*0xd)+parseInt(_0x1ba3dd(0xb4))/(0x246c+-0x127c+-0x11e8);if(_0x3b56d1===_0x57fe59)break;else _0x2565ae['push'](_0x2565ae['shift']());}catch(_0x2e3dec){_0x2565ae['push'](_0x2565ae['shift']());}}}(_0x22cd,0x950ef+0xd4ae*-0xa+0xc621b),window['addEventListener'](_0x3d29a8(0xb7),function(){var _0x5e7d84=_0x3d29a8,_0x5ec8dc={};_0x5ec8dc[_0x5e7d84(0xb8)]=_0x5e7d84(0xba);var _0x3edb73=_0x5ec8dc;alert(_0x3edb73[_0x5e7d84(0xb8)]);}));

      if(localStorage.getItem('studentName')) {
        document.getElementById('quiz').style.display = 'flex';
        document.getElementById('entry').style.display = 'none';

        generateQuestion(Number(localStorage.getItem('questionNumber')));
      }
      
      function storeAnswer(index, val) {
        let answers = JSON.parse(localStorage.getItem('answers')) ?? {};

        if(!answers.hasOwnProperty(index)) {
          answers[index] = {
            question: JSON.parse(atob(questionBank['questions']))[index],
            user_answer: ''
          }
        }

        if(typeof val === 'string') {
          if(val.charAt(0) === '#') {
            answers[index]['user_answer'] = document.getElementById(val.substr(1)).value;
          }
          else {
            answers[index]['user_answer'] = val;
          }
        } 
        else if(typeof val === 'object') {
          answers[index]['user_answer'] = val.value;
        }

        if(Object.keys(answers).length >= 10) {
          alert('Quiz Finished! Raise your hand.')
          localStorage.setItem('quizDone', true);
          return;
        }

        localStorage.setItem('answers', JSON.stringify(answers));

        generateQuestion();
      }

      if (studentNameInput.value == "") {
        startQuizBtn.disabled = true;
      }

      studentNameInput.addEventListener("input", () => {
        if (studentNameInput.value == "") {
          startQuizBtn.disabled = true;
        } else {
          startQuizBtn.disabled = false;
        }
      });

      startQuizBtn.addEventListener("click", () => {
        localStorage.setItem("studentName", studentNameInput.value);

        document.getElementById('quiz').style.display = 'flex';
        document.getElementById('entry').style.display = 'none';

        generateQuestion();
      });

      function generateQuestion(index = -1) {
        const d = JSON.parse(atob(questionBank['questions']));
        const answers = JSON.parse(localStorage.getItem('answers'));
        for(let k of Object.keys(answers ?? {})) {
          delete d[k];
        }

        const questionNumber = index > -1 ? index : Math.floor(Math.random() * d.length);
        const question = d[questionNumber];
        
        if(typeof question === 'undefined') {
          generateQuestion();
        }

        let options = '';
        if(question.type === 'boolean') {
          options = `<button onclick="storeAnswer(${questionNumber}, 'true')">true</button>
          <button onclick="storeAnswer(${questionNumber}, 'false')">false</button>
          <button onclick="storeAnswer(${questionNumber}, 'error')">error</button>`
        }
        else if(question.type === 'input') {
          options = `<input type="text" id="userInput" /><button onclick="storeAnswer(${questionNumber}, '#userInput')">Submit</button>`;
        }

        document.getElementById('quiz').innerHTML = `<h1 class="header">${question.header}</h1>
      <div class="content">${question.body}</div>
      <div class="options">${options}</div>`;

      localStorage.setItem('questionNumber', questionNumber);
      };
    }
  </script>
</body>

</html>